# ./volumes/api/kong.yml
_format_version: "2.1"
_transform: true

services:
  - name: auth
    url: http://auth:9999
    routes:
      - name: auth-routes
        paths: [ /auth/v1, /auth/v1/ ]
        strip_path: true

  - name: rest
    url: http://rest:3000
    routes:
      - name: rest-routes
        paths: [ /rest/v1, /rest/v1/ ]
        strip_path: true

  - name: storage
    url: http://storage:5000
    routes:
      - name: storage-routes
        paths: [ /storage/v1, /storage/v1/ ]
        strip_path: true

  - name: realtime
    url: http://realtime:4000
    routes:
      - name: realtime-routes
        paths: [ /realtime/v1, /realtime/v1/ ]
        strip_path: true

  - name: meta
    url: http://meta:8080
    routes:
      - name: meta-routes
        paths: [ /pg, /pg/ ]
        strip_path: true

  # Serve the Supabase dashboard (Studio) at http://localhost:8000/
  - name: studio
    url: http://studio:3000
    routes:
      - name: studio-root
        paths: [ / ]
        strip_path: false

plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
      methods: [ GET, POST, PUT, PATCH, DELETE, OPTIONS ]
      headers:
        - Authorization
        - apikey
        - Content-Type
        - X-Client-Info
        - X-Supabase-Api-Version
      exposed_headers: [ Content-Range, Content-Disposition ]
      credentials: true
      max_age: 3600

